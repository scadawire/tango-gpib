#=============================================================================
#
# file :        Makefile.h
#
# description : Include for the GpibDeviceServer class.
#
# project :     Makefile to generate a Tango server
#
# $Author: vedder_bruno $
#
# $Revision: 1.8 $
#
# copyleft :    European Synchrotron Radiation Facility
#               BP 220, Grenoble 38043
#               FRANCE
#
#=============================================================================
#  		This file is generated by POGO
#	(Program Obviously used to Generate tango Object)
#
#         (c) - Software Engineering Group - ESRF
#=============================================================================
#

ifdef _solaris
CC = CC
#BIN_DIR = solaris9_CC
BIN_DIR=$(shell /csadmin/common/scripts/get_os)_CC
endif

ifdef linux
CC = c++
AR = ar
BIN_DIR=$(shell /csadmin/common/scripts/get_os)
GPIB_INC = /segfs/linux/drivers/nigpib/NI-GPIB-2.5.1f0/include/
GPIB_LIB = /segfs/linux/drivers/nigpib/NI-GPIB-2.5.1f0/lib/
endif


TANGO_HOME   =  /segfs/tango/release
INCLUDE_DIRS =  -I$(TANGO_HOME)/$(BIN_DIR)/include/	-I.	-I$(GPIB_INC)
LIB_DIRS     =  -L$(TANGO_HOME)/$(BIN_DIR)/lib/ -L.	-L$(GPIB_LIB)

ifdef _solaris
CXXFLAGS =  -mt -D_PTHREADS $(INCLUDE_DIRS) -D_solaris
#LFLAGS =  			-Bstatic $(LIB_DIRS)
LFLAGS =  			$(LIB_DIRS)  	\
				-lgpib	\
				-ltango			\
				-lomniORB4 		\
				-lomniDynamic4	\
				-lomnithread	\
				-lCOS4			\
				-lgpib		\
				-Bdynamic	\
				-llog4tango		\
				-lpthread		\
				-lposix4 -lsocket -lnsl
endif

ifdef linux
# -DNI4882 is required for NI4882 driver.
CXXFLAGS =  -g -D_REENTRANT -DNI4882 $(INCLUDE_DIRS) 
LFLAGS =  -g $(LIB_DIRS)  		\
				-ltango			\
				-llog4tango		\
				-lomniORB4 		\
				-lomniDynamic4	\
				-lomnithread	\
				-lCOS4			\
				-ldl -lpthread \
				$(GPIB_LIB)/libgpibapi.so.2.5.1 \
				$(GPIB_LIB)/libgpibconf.so.2.5.1 \
				$(GPIB_LIB)/libgpibconf.so.2.5.1 \
				$(GPIB_LIB)/libnipalu.so
endif




CLASS =	GpibDeviceServer

SVC_OBJS = 	main.o	\
		ClassFactory.o	\
		$(CLASS)Class.o	\
		$(CLASS).o \
		$(CLASS)StateMachine.o \
		gpibDevice.o \
		gpibDeviceException.o

SVC_INC = 	$(CLASS)Class.h \
			$(CLASS).h


%.o: %.cpp $(SVC_INC)
	$(CC) $(CXXFLAGS) -c $<
			
all: $(CLASS)

$(CLASS):	$(SVC_OBJS)
	$(CC) $(SVC_OBJS) -o $(CLASS) $(LFLAGS)

clean:
	rm -f *.o $(CLASS) core
	
install:
	cp $(CLASS) $(TANGO_HOME)/bin/$(BIN_DIR)
